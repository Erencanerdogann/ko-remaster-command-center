<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KO REMASTER // COMMAND CENTER</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="supabase.js"></script>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <h1>KO REMASTER <span class="mono" style="font-weight:900; opacity:.75"> // COMMAND CENTER</span></h1>
      <div class="sub"><span data-lang="status_label">Durum:</span> <span class="mono" id="statusText">‚Äî</span></div>
    </div>

    <div class="statusLine">
      <div class="chip"><span class="dot" id="healthDot"></span><span><strong id="healthLabel">STABLE</strong> <span class="mono" style="opacity:.9" id="healthDetail">‚Äî</span></span></div>
      <div class="chip"><span data-lang="lbl_active">Active:</span> <strong class="mono" id="sActive">0</strong></div>
      <div class="chip"><span data-lang="lbl_done">Done:</span> <strong class="mono" id="sDone">0</strong></div>
      <div class="chip"><span data-lang="lbl_crit">Critical:</span> <strong class="mono" id="sCrit">0</strong></div>
      <div class="chip"><span data-lang="lbl_last_save">Son Kayƒ±t:</span> <strong class="mono" id="sSave">‚Äî</strong></div>

      <button class="btn primary" onclick="openCreate()" data-lang="btn_new">Ôºã YENƒ∞ EKLE</button>
      <button class="btn" onclick="downloadBackup()" data-lang="btn_json">‚§ì JSON</button>
      <button class="btn" onclick="triggerImport()" data-lang="btn_import">‚§í Import</button>
      <button class="btn good" onclick="manualSave()" data-lang="btn_save">üíæ Kaydet</button>
      <button class="btn danger" onclick="hardReset()" data-lang="btn_reset">üß® Sƒ±fƒ±rla</button>
      <button class="btn" onclick="toggleTheme()" id="themeBtn" title="Tema Deƒüi≈ütir">‚òÄ</button>
      <button class="btn" onclick="toggleLang()" id="langBtn" style="min-width:36px; justify-content:center">TR</button>

      <input type="file" id="importFile" accept="application/json" style="display:none" />
    </div>
  </div>

  <div class="container">

    <!-- LEFT -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <strong data-lang="p_private_eren">üë§ PRIVATE: ERENCAN</strong>
          <span data-lang="p_private_eren_sub">Notlar / snippet / g√ºnl√ºk</span>
        </div>
        <span class="chip"><span class="dot" style="background:var(--blue); box-shadow:0 0 0 3px rgba(59,130,246,.14)"></span><span class="mono">LOCAL</span></span>
      </div>

      <div class="panel-body">
        <textarea id="noteErencan" class="note" placeholder="// Burasƒ± senin alanƒ±n.\n// Bug notlarƒ±, SQL, C++ snippet, ToDo, commit mesajlarƒ±...\n// (Auto-save a√ßƒ±k)"></textarea>

        <!-- GITHUB INTEGRATION -->
        <div class="section" id="gitSection" style="margin-top:12px; border-color:rgba(255,255,255,.15)">
          <div class="section-head" style="background:rgba(255,255,255,.04)">
            <b style="display:flex; align-items:center; gap:6px"><span data-lang="sec_git">GITHUB</span> <span class="mono" style="opacity:.5; font-size:10px" id="repoLabel"></span></b>
            <div style="display:flex; gap:4px; align-items:center">
              <div id="gitLed" style="width:8px; height:8px; border-radius:50%; background:#444; margin-right:4px; transition:0.3s; box-shadow:0 0 0 1px rgba(255,255,255,.1)"></div>
              <span id="gitLastTime" class="mono" style="font-size:9px; color:var(--txt-muted); margin-right:2px"></span>
              <button class="btn" style="padding:2px 6px; font-size:10px; height:auto" title="Git Durumunu Kontrol Et" onclick="fetchGitCommits()">üì° Check</button>
              <button class="btn" style="padding:2px 6px; font-size:10px; height:auto" onclick="fetchGitCommits()">‚Üª</button>
            </div>
          </div>
          <div class="section-body" id="gitList" style="max-height:180px; overflow:auto; display:flex; flex-direction:column; gap:8px">
            <div class="mini" style="opacity:.5">Repo ayarƒ± yapƒ±lmadƒ±...</div>
          </div>
        </div>

        <div class="section">
          <div class="section-head">
            <b data-lang="sec_format">Task Yazma Formatƒ±</b>
            <span class="mono" style="color:var(--txt-muted); font-size:12px" data-lang="sec_format_sub">net & anla≈üƒ±lƒ±r</span>
          </div>
          <div class="section-body">
            <div class="hint">
              <span class="mono">PROBLEM</span> ‚Üí ne oluyor?<br/>
              <span class="mono">SEBEP (varsayƒ±m)</span> ‚Üí neden oluyor?<br/>
              <span class="mono">√á√ñZ√úM</span> ‚Üí adƒ±m adƒ±m nasƒ±l d√ºzelir?<br/>
              <span class="mono">DONE</span> ‚Üí hangi testte ‚Äúbitti‚Äù deriz?
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-head">
            <b data-lang="sec_mentor">üë®‚Äçüè´ PRIVATE: TAYFUN HOCA</b>
            <span class="mono" style="color:var(--c-amber)">MENTOR MODE</span>
          </div>
          <div class="section-body">
            <textarea id="noteTayfun" class="note" style="height:180px" placeholder="// Hoca notlarƒ±.\n// Engine kararlarƒ±, entity mapping, network authority, vb."></textarea>
          </div>
        </div>

      </div>
    </div>

    <!-- CENTER -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <strong data-lang="p_tasks">üìã G√ñREV Y√ñNETƒ∞Mƒ∞</strong>
          <span class="mono" id="activeInfo">‚Äî</span>
        </div>
        <div style="display:flex; gap:10px; align-items:center">
          <button class="btn primary" onclick="openCreate()" style="padding:6px 12px; font-size:11px" data-lang="btn_new">Ôºã YENƒ∞ EKLE</button>
          <span class="chip"><span class="dot amber"></span><span class="mono" id="nowTime">‚Äî</span></span>
        </div>
      </div>

      <div class="toolbar">
        <div class="field" style="min-width:220px; flex: 2 1 auto;">
          <label>Search</label>
          <input id="q" placeholder="id / ba≈ülƒ±k / subsystem / i√ßerik..." />
        </div>

        <div class="field">
          <label>Subsystem</label>
          <select id="fSubsystem">
            <option value="">(Hepsi)</option>
          </select>
        </div>

        <div class="field">
          <label>Priority</label>
          <select id="fPriority">
            <option value="">(Hepsi)</option>
            <option value="blocker">CRITICAL</option>
            <option value="high">HIGH</option>
            <option value="normal">NORMAL</option>
          </select>
        </div>

        <div class="field">
          <label>Owner</label>
          <select id="fOwner">
            <option value="">(Hepsi)</option>
            <option value="Eren">Eren</option>
            <option value="Tayfun">Tayfun</option>
            <option value="Client">Client</option>
            <option value="Server">Server</option>
          </select>
        </div>

        <div class="field" style="min-width:auto; flex:0 0 auto">
          <label>View</label>
          <label style="display:flex; align-items:center; gap:8px; height:38px; padding:0 10px; background:var(--bg-input-dark); border:1px solid var(--border-base); border-radius:10px; cursor:pointer">
            <input type="checkbox" id="fHideDone" style="accent-color:var(--c-blue); width:14px; height:14px">
            <span style="font-size:12px; font-weight:500">Hide Done</span>
          </label>
        </div>

        <div class="field" style="min-width:180px;">
          <label>Sort</label>
          <select id="sortBy">
            <option value="prio">√ñncelik</option>
            <option value="updated">Son G√ºncelleme</option>
            <option value="progress">ƒ∞lerleme %</option>
            <option value="created">Olu≈üturma</option>
          </select>
        </div>
      </div>

      <div class="kanban">
        <div class="col">
          <div class="col-head"><b data-lang="col_todo">Yapƒ±lacak</b><span class="count" id="cTodo">0</span></div>
          <div class="cards" id="todo"></div>
        </div>

        <div class="col">
          <div class="col-head"><b data-lang="col_doing">S√ºr√ºyor</b><span class="count" id="cDoing">0</span></div>
          <div class="cards" id="doing"></div>
        </div>

        <div class="col">
          <div class="col-head"><b data-lang="col_done">Bitti</b><span class="count" id="cDone">0</span></div>
          <div class="cards" id="done"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <strong data-lang="p_stats">üìà Bƒ∞TME GRAFƒ∞ƒûƒ∞</strong>
          <span data-lang="p_stats_sub">Ortalama ilerleme + daƒüƒ±lƒ±m</span>
        </div>
        <button class="btn" onclick="recalc()">‚Üª Yenile</button>
      </div>

      <div class="panel-body slim">
        <!-- NEW COMPACT METRICS (JS Generated) -->
        <div id="keyMetrics"></div>

        <div class="donutWrap">
          <div class="donut" id="donut">
            <div class="in">
              <b id="donutVal">0%</b>
              <span>Done</span>
            </div>
          </div>
          <div class="legend">
            <div class="leg"><span><i></i> NORMAL</span><span class="mono" id="lNormal">0</span></div>
            <div class="leg a"><span><i></i> HIGH</span><span class="mono" id="lHigh">0</span></div>
            <div class="leg r"><span><i></i> CRITICAL</span><span class="mono" id="lCrit">0</span></div>
            <div class="leg g"><span><i></i> DONE</span><span class="mono" id="lDone">0</span></div>
          </div>
        </div>

        <div class="timeline">
          <div class="tHead">
            <b data-lang="st_timeline">Deƒüi≈üiklik Akƒ±≈üƒ±</b>
            <span class="mono" id="logCount">0 event</span>
          </div>
          <div class="events" id="events"></div>
        </div>

        <div class="section" style="margin-top:10px">
          <div class="section-head">
            <b data-lang="sec_subsys">Subsystem Progress</b>
            <span class="mono" style="color:var(--txt-muted)">auto</span>
          </div>
          <div class="section-body" id="subsysBars"></div>
        </div>
      </div>
    </div>

  </div>

  <!-- MODAL -->
  <div class="modalBack" id="modalBack" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modalHead">
        <b id="modalTitle" data-lang="mod_task">G√ñREV</b>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end">
          <button class="btn" onclick="quickMove('todo')">ToDo</button>
          <button class="btn primary" onclick="quickMove('doing')">InProg</button>
          <button class="btn good" onclick="quickMove('done')">Done</button>
          <button class="btn danger" onclick="deleteCurrent()">üóëÔ∏è Sil</button>
          <button class="btn" onclick="closeModal()">‚úï</button>
        </div>
      </div>

      <div class="modalBody">
        <div class="box">
          <div class="bh">
            <b data-lang="mod_det">Detay</b>
            <span class="mono" id="taskIdMono">#‚Äî</span>
          </div>
          <div class="bb">
            <input class="inpt" id="t_title" placeholder="Ba≈ülƒ±k (kƒ±sa + net)"/>

            <div class="row3">
              <select class="sel" id="t_priority">
                <option value="normal">NORMAL</option>
                <option value="high">HIGH</option>
                <option value="blocker">CRITICAL</option>
              </select>
              <select class="sel" id="t_status">
                <option value="todo">ToDo</option>
                <option value="doing">In Progress</option>
                <option value="done">Done</option>
              </select>
              <input class="inpt" id="t_progress" type="number" min="0" max="100" placeholder="Progress % (0-100)"/>
            </div>

            <div class="row2">
              <input class="inpt" id="t_subsystem" placeholder="Subsystem (Entity / Input / UI / Login / Network...)"/>
              <select class="sel" id="t_owner">
                <option value="Eren">Eren</option>
                <option value="Tayfun">Tayfun</option>
                <option value="Client">Client</option>
                <option value="Server">Server</option>
              </select>
            </div>

            <textarea class="ta" id="t_problem" placeholder="PROBLEM\n- Ne oluyor?\n- Nerede oluyor?\n- Oyuncu ne hissediyor?"></textarea>
            <textarea class="ta" id="t_hypothesis" placeholder="SEBEP (VARSAYIM)\n- Neden oluyor olabilir?\n- Kanƒ±t geldik√ße g√ºncelle."></textarea>
            <textarea class="ta" id="t_solution" placeholder="√á√ñZ√úM\n- Adƒ±m adƒ±m\n- Hangi katman/dosya\n- Pseudo-code olabilir"></textarea>
            <textarea class="ta" id="t_done" placeholder="DONE KRƒ∞TERƒ∞\n- QA adƒ±mlarƒ±\n- Beklenen sonu√ßlar"></textarea>
          </div>
        </div>

        <div class="box">
          <div class="bh">
            <b data-lang="mod_ops">Operasyon</b>
            <span class="mono" id="metaMono">‚Äî</span>
          </div>
          <div class="bb">
            <div class="row2">
              <button class="btn good" onclick="saveModal()">‚úÖ Kaydet</button>
              <button class="btn" onclick="logEvent('Manual note added')">üßæ Log</button>
            </div>

            <div class="section" style="margin-top:10px">
              <div class="section-head">
                <b data-lang="mod_quick">Hƒ±zlƒ± ƒ∞lerleme</b>
                <span class="mono" style="color:var(--txt-muted)">safe</span>
              </div>
              <div class="section-body" style="display:flex; gap:8px; flex-wrap:wrap">
                <button class="btn p0" onclick="setProgress(0)">0%</button>
                <button class="btn p25" onclick="setProgress(25)">25%</button>
                <button class="btn p50" onclick="setProgress(50)">50%</button>
                <button class="btn p75" onclick="setProgress(75)">75%</button>
                <button class="btn p100" onclick="setProgress(100)">100%</button>
              </div>
            </div>

            <div class="section" style="margin-top:10px">
              <div class="section-head">
                <b data-lang="mod_checklist">CheckList</b>
                <span class="mono" style="color:var(--txt-muted)">optional</span>
              </div>
              <div class="section-body">
                <textarea class="ta" id="t_steps" style="min-height:140px" placeholder="- [ ] ...\n- [ ] ...\n- [ ] ..."></textarea>
              </div>
            </div>

            <div class="section" style="margin-top:10px">
              <div class="section-head">
                <b data-lang="mod_risk">Risk / Not</b>
                <span class="mono" style="color:var(--c-red)">optional</span>
              </div>
              <div class="section-body">
                <textarea class="ta" id="t_risk" style="min-height:110px" placeholder="Baƒüƒ±mlƒ±lƒ±k / risk / blokaj..."></textarea>
              </div>
            </div>

            <!-- DEBUG PROTOCOL (Binary Search Isolation) -->
            <div class="section" style="margin-top:10px; border-color:rgba(245,158,11,.3); background:rgba(245,158,11,.04)">
              <div class="section-head" style="background:rgba(245,158,11,.06)">
                <b style="color:var(--c-amber)" data-lang="mod_debug">üêû DEBUG PROTOCOL</b>
                <span class="mono" style="color:var(--c-amber); opacity:.8">Binary Search</span>
              </div>
              <div class="section-body" style="display:flex; flex-direction:column; gap:8px">
                <label style="display:flex; gap:8px; align-items:center; cursor:pointer">
                  <input type="checkbox" id="dbg_1"> <span class="mini" style="color:var(--txt-main)">1. Disable all suspect code (Isolation)</span>
                </label>
                <label style="display:flex; gap:8px; align-items:center; cursor:pointer">
                  <input type="checkbox" id="dbg_2"> <span class="mini" style="color:var(--txt-main)">2. Enable piece by piece (Find break point)</span>
                </label>
                <label style="display:flex; gap:8px; align-items:center; cursor:pointer">
                  <input type="checkbox" id="dbg_3"> <span class="mini" style="color:var(--txt-main)">3. Go inside & repeat (Narrow down)</span>
                </label>
                <label style="display:flex; gap:8px; align-items:center; cursor:pointer">
                  <input type="checkbox" id="dbg_4"> <span class="mini" style="color:var(--txt-main)">4. Find exact line (Root cause)</span>
                </label>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- OFFLINE WARNING -->
  <div id="offlineBadge" class="offline-badge" style="display:none">üì° OFFLINE MODE</div>

<script src="app.js"></script>

</body>
</html>
